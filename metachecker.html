<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Meta-Checker â€“ Media Aachen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #1a365d;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      animation: spin 0.8s linear infinite;
      display: inline-block;
    }
    @keyframes spin {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}
  </style>
</head>
<body class="bg-gray-50 text-gray-800 text-base">

  <!-- Header -->
  <header class="bg-[#1a365d] text-white shadow">
    <div class="max-w-5xl mx-auto px-4 py-4 flex justify-between items-center">
      <h1 class="text-lg sm:text-xl font-bold">ğŸ” Meta-Checker</h1>
      <a href="/" class="bg-white text-[#1a365d] px-4 py-2 rounded-full font-semibold shadow hover:bg-gray-100">â¬…ï¸ ZurÃ¼ck</a>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-5xl mx-auto py-8 px-4">
    <h1 class="text-2xl sm:text-3xl font-bold mb-6">Meta-Tags Checker</h1>

    <!-- Formular -->
    <form id="checker-form" class="flex flex-col sm:flex-row gap-3 mb-8">
      <input type="url" id="url" placeholder="https://example.com"
        class="flex-1 border rounded-lg px-4 py-3 shadow-sm focus:ring-2 focus:ring-[#1a365d]" required>
      <button type="submit" id="checkBtn"
        class="bg-[#1a365d] text-white px-6 py-3 rounded-full shadow-lg hover:bg-[#0f2340] transition disabled:opacity-70">
        <span id="btnText">ğŸš€ PrÃ¼fen</span>
      </button>
    </form>

    <div id="results" class="space-y-10"></div>
  </main>

  <!-- Ladeoverlay -->
  <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 flex flex-col items-center w-80">
      <div class="spinner mb-3"></div>
      <p class="text-gray-700 font-semibold mb-4">Wird geladenâ€¦</p>
      <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
        <div id="progressBar" class="bg-[#1a365d] h-2 w-0"></div>
      </div>
    </div>
  </div>

<script>
// Hilfsfunktionen
function checkLength(text, min, max) {
  if (!text) return 'âŒ fehlt';
  if (text.length < min) return `âš ï¸ zu kurz (${text.length})`;
  if (text.length > max) return `âš ï¸ zu lang (${text.length})`;
  return `âœ… ok (${text.length})`;
}
function checkCount(name, count, min, max) {
  if (count === 0) return `âŒ ${name} fehlt`;
  if (min && count < min) return `âš ï¸ ${name} zu wenig (${count})`;
  if (max && count > max) return `âš ï¸ ${name} zu viele (${count})`;
  return `âœ… ${name} ok (${count})`;
}
function copyMeta() {
  const code = document.getElementById("metaCode");
  if (code) {
    navigator.clipboard.writeText(code.innerText);
    alert("Meta-Tags kopiert!");
  }
}
function calculateSeoScore(data) {
  let score = 0, maxScore = 20;
  if (data.h1.length === 1) score++;
  if (data.h2.length >= 2) score++;
  if (data.h3.length >= 1 && data.h3.length <= 25) score++;
  if (data.title && data.title.length >= 10 && data.title.length <= 60) score++;
  if (data.description && data.description.length >= 50 && data.description.length <= 160) score++;
  if (data.canonical) score++;
  if (data.robots) score++;
  if (data.author) score++;
  if (data.ogImage) score++;
  if (data.twitterImage) score++;
  if (data.bold.length >= 3 && data.bold.length <= 20) score++;
  if (data.wordCount > 300) score++;
  if (data.images.total > 0 && data.images.withAlt === data.images.total) score++;
  if (data.links.internal > 5) score++;
  if (data.links.external >= 1) score++;
  return Math.round((score / maxScore) * 100);
}
async function animateProgress() {
  const bar = document.getElementById("progressBar");
  let width = 0;
  return setInterval(() => {
    width += Math.random() * 15;
    if (width >= 95) width = 95;
    bar.style.width = width + "%";
  }, 400);
}

// Event: Formular
document.getElementById("checker-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const url = document.getElementById("url").value;
  const overlay = document.getElementById("loadingOverlay");
  overlay.classList.remove("hidden");
  let progressInterval = await animateProgress();

  try {
    // Frontend-only via AllOrigins
    const res = await fetch("https://api.allorigins.win/get?url=" + encodeURIComponent(url));
    if (!res.ok) throw new Error("Proxy-Fehler (" + res.status + ")");
    const data = await res.json();
    const doc = new DOMParser().parseFromString(data.contents, "text/html");

    const parsed = {
      title: doc.querySelector("title")?.innerText || "",
      description: doc.querySelector("meta[name='description']")?.content || "",
      canonical: doc.querySelector("link[rel='canonical']")?.href || "",
      robots: doc.querySelector("meta[name='robots']")?.content || "",
      author: doc.querySelector("meta[name='author']")?.content || "",
      ogTitle: doc.querySelector("meta[property='og:title']")?.content || "",
      ogDescription: doc.querySelector("meta[property='og:description']")?.content || "",
      ogImage: doc.querySelector("meta[property='og:image']")?.content || "",
      twitterTitle: doc.querySelector("meta[name='twitter:title']")?.content || "",
      twitterDescription: doc.querySelector("meta[name='twitter:description']")?.content || "",
      twitterImage: doc.querySelector("meta[name='twitter:image']")?.content || "",
      h1: [...doc.querySelectorAll("h1")].map(h => h.innerText),
      h2: [...doc.querySelectorAll("h2")].map(h => h.innerText),
      h3: [...doc.querySelectorAll("h3")].map(h => h.innerText),
      bold: [...doc.querySelectorAll("b,strong")].map(b => b.innerText),
      images: {
        total: doc.querySelectorAll("img").length,
        withAlt: [...doc.querySelectorAll("img")].filter(i => i.alt).length
      },
      links: {
        total: doc.querySelectorAll("a").length,
        internal: [...doc.querySelectorAll("a")].filter(a => new URL(a.href, url).hostname === new URL(url).hostname).length,
        external: [...doc.querySelectorAll("a")].filter(a => new URL(a.href, url).hostname !== new URL(url).hostname).length
      },
      wordCount: doc.body.innerText.split(/\s+/).filter(Boolean).length
    };

    const seoScore = calculateSeoScore(parsed);
    const circleRadius = 50;
    const circumference = 2 * Math.PI * circleRadius;
    const offset = circumference - (seoScore / 100) * circumference;
    const color = seoScore>=80 ? '#16a34a' : seoScore>=50 ? '#f59e0b' : '#dc2626';

    document.getElementById("results").innerHTML = `
      <section class="bg-white p-6 shadow rounded-lg">
        <h2 class="text-xl font-bold mb-4">â­ SEO Score</h2>
        <div class="flex flex-col items-center">
          <svg class="w-32 h-32 transform -rotate-90 mb-4">
            <circle cx="64" cy="64" r="${circleRadius}" stroke="#e5e7eb" stroke-width="10" fill="none"/>
            <circle cx="64" cy="64" r="${circleRadius}" stroke="${color}" stroke-width="10" fill="none"
              stroke-dasharray="${circumference}" stroke-dashoffset="${offset}" stroke-linecap="round"/>
          </svg>
          <p class="text-2xl font-bold" style="color:${color}">${seoScore} / 100</p>
        </div>
      </section>

      <section class="bg-white p-6 shadow rounded-lg">
        <h2 class="text-xl font-bold mb-4">ğŸ” Struktur-Analyse</h2>
        <ul class="list-disc pl-6 space-y-1">
          <li>${checkCount("H1", parsed.h1.length,1,1)}</li>
          <li>${checkCount("H2", parsed.h2.length,2,null)}</li>
          <li>${checkCount("H3", parsed.h3.length,1,25)}</li>
          <li>${checkCount("Fette WÃ¶rter", parsed.bold.length,3,20)}</li>
          <li>Bilder: ${parsed.images.withAlt}/${parsed.images.total} mit ALT</li>
          <li>WÃ¶rter im Text: ${parsed.wordCount}</li>
        </ul>
      </section>

      <section class="bg-white p-6 shadow rounded-lg">
        <h2 class="text-xl font-bold mb-4">ğŸ“‘ Meta-Daten</h2>
        <p><b>Title:</b> ${parsed.title} (${checkLength(parsed.title,10,60)})</p>
        <p><b>Description:</b> ${parsed.description} (${checkLength(parsed.description,50,160)})</p>
        <p><b>Canonical:</b> ${parsed.canonical||"âŒ fehlt"}</p>
        <p><b>Robots:</b> ${parsed.robots||"âŒ fehlt"}</p>
        <p><b>Author:</b> ${parsed.author||"âŒ fehlt"}</p>
        <p><b>OG Image:</b> ${parsed.ogImage||"âŒ fehlt"}</p>
        <p><b>Twitter Image:</b> ${parsed.twitterImage||"âŒ fehlt"}</p>
      </section>

      <section class="bg-white p-6 shadow rounded-lg">
        <h2 class="text-xl font-bold mb-4">ğŸ“± Social Preview</h2>
        <div class="grid md:grid-cols-2 gap-6">
          <div class="border rounded shadow p-3">
            <h3 class="font-semibold mb-2">Facebook / LinkedIn</h3>
            <img src="${parsed.ogImage||'https://via.placeholder.com/200x120'}" class="mb-2"/>
            <p class="font-bold">${parsed.ogTitle||parsed.title||'Kein Titel'}</p>
            <p>${parsed.ogDescription||parsed.description||'Keine Beschreibung'}</p>
          </div>
          <div class="border rounded shadow p-3">
            <h3 class="font-semibold mb-2">Twitter / X</h3>
            <img src="${parsed.twitterImage||'https://via.placeholder.com/200x120'}" class="mb-2"/>
            <p class="font-bold">${parsed.twitterTitle||parsed.title||'Kein Titel'}</p>
            <p>${parsed.twitterDescription||parsed.description||'Keine Beschreibung'}</p>
          </div>
        </div>
      </section>

      <section>
        <h2 class="text-xl font-bold mt-6 mb-2">ğŸ“‹ Use your Meta-Tags</h2>
        <pre id="metaCode" class="bg-gray-100 p-4 rounded">${`
<title>${parsed.title||''}</title>
<meta name="description" content="${parsed.description||''}">
<meta property="og:title" content="${parsed.ogTitle||parsed.title||''}">
<meta property="og:description" content="${parsed.ogDescription||parsed.description||''}">
<meta property="og:image" content="${parsed.ogImage||''}">
<meta name="twitter:title" content="${parsed.twitterTitle||parsed.title||''}">
<meta name="twitter:description" content="${parsed.twitterDescription||parsed.description||''}">
<meta name="twitter:image" content="${parsed.twitterImage||''}">
<link rel="canonical" href="${parsed.canonical||url}">
<meta name="robots" content="${parsed.robots||''}">
<meta name="author" content="${parsed.author||''}">
        `}</pre>
        <button onclick="copyMeta()" class="mt-2 bg-[#1a365d] text-white px-4 py-2 rounded">ğŸ“‹ Kopieren</button>
      </section>
    `;

    overlay.classList.add("hidden");
  } catch (err) {
    document.getElementById("results").innerHTML = `<p class="text-red-600">âŒ Fehler: ${err.message}</p>`;
    overlay.classList.add("hidden");
  } finally {
    clearInterval(progressInterval);
  }
});
</script>
</body>
</html>
