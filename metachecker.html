<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>SEO Meta-Checker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #2563eb;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      animation: spin 0.8s linear infinite;
      display: inline-block;
    }
    @keyframes spin {0% {transform: rotate(0deg);}100% {transform: rotate(360deg);}}
  </style>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- Header -->
  <header class="bg-white shadow sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
      <a href="index.html" class="text-2xl font-bold text-blue-600">SEO Experte Aachen</a>
      <a href="index.html" class="bg-blue-600 text-white px-4 py-2 rounded-lg shadow hover:bg-blue-700 transition">⬅️ Zurück</a>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-6xl mx-auto py-12 px-6">
    <h1 class="text-3xl sm:text-4xl font-bold mb-6 text-center">🔍 SEO Meta-Checker</h1>
    <p class="text-center mb-8">Überprüfen Sie Meta-Tags, Struktur, Inhalte und Social Previews einer Webseite.</p>

    <!-- Formular -->
    <form id="checker-form" class="flex flex-col sm:flex-row gap-3 mb-8">
      <input type="url" id="url" placeholder="https://example.com"
        class="flex-1 border rounded-lg px-4 py-3 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-600" required>
      <button type="submit" id="checkBtn"
        class="flex items-center justify-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-lg shadow hover:bg-blue-700 transition">
        <span id="btnText">🚀 Prüfen</span>
      </button>
    </form>

    <div id="results" class="space-y-10"></div>
  </main>

  <!-- Ladeoverlay -->
  <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-lg shadow-lg p-6 flex flex-col items-center w-80">
      <div class="spinner mb-3"></div>
      <p class="text-gray-700 font-semibold mb-4">Wird geladen…</p>
      <div class="w-full bg-gray-200 rounded-full h-2 overflow-hidden">
        <div id="progressBar" class="bg-blue-600 h-2 w-0"></div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-6 mt-16">
    <div class="max-w-6xl mx-auto px-6 flex flex-col md:flex-row justify-between items-center">
      <p>© 2025 SEO Experte Aachen – Alle Rechte vorbehalten.</p>
      <div class="space-x-4">
        <a href="impressum.html" class="hover:underline">Impressum</a>
        <a href="datenschutz.html" class="hover:underline">Datenschutzerklärung</a>
      </div>
    </div>
  </footer>

<script>
function checkLength(text, min, max) {
  if (!text) return '❌ fehlt';
  if (text.length < min) return `⚠️ zu kurz (${text.length})`;
  if (text.length > max) return `⚠️ zu lang (${text.length})`;
  return `✅ ok (${text.length})`;
}

function checkCount(name, count, min, max) {
  if (count === 0) return `❌ ${name} fehlt`;
  if (min && count < min) return `⚠️ ${name} zu wenig (${count})`;
  if (max && count > max) return `⚠️ ${name} zu viele (${count})`;
  return `✅ ${name} ok (${count})`;
}

function calculateSeoScore(data) {
  let score = 0, maxScore = 12;
  if (data.title && data.title.length >= 10 && data.title.length <= 60) score++;
  if (data.description && data.description.length >= 50 && data.description.length <= 160) score++;
  if (data.ogImage) score++;
  if (data.twitterImage) score++;
  if (data.canonical) score++;
  if (data.robots) score++;
  if (data.author) score++;
  if (data.h1.length === 1) score++;
  if (data.h2.length >= 2) score++;
  if (data.bold.length >= 3 && data.bold.length <= 15) score++;
  if (data.images.total > 0 && data.images.withAlt === data.images.total) score++;
  if (data.links.internal > 0) score++;
  return Math.round((score / maxScore) * 100);
}

async function animateProgress() {
  const bar = document.getElementById("progressBar");
  let width = 0;
  return setInterval(() => {
    width += Math.random() * 15;
    if (width >= 95) width = 95;
    bar.style.width = width + "%";
  }, 400);
}

document.getElementById("checker-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  const url = document.getElementById("url").value;
  const overlay = document.getElementById("loadingOverlay");
  const btn = document.getElementById("checkBtn");
  const btnText = document.getElementById("btnText");
  overlay.classList.remove("hidden");
  btn.disabled = true;
  btnText.textContent = "Prüfen...";
  let progressInterval = await animateProgress();

  try {
    const res = await fetch("https://api.allorigins.win/get?url=" + encodeURIComponent(url));
    const data = await res.json();
    const doc = new DOMParser().parseFromString(data.contents, "text/html");

    const parsed = {
      title: doc.querySelector("title")?.innerText || "",
      description: doc.querySelector("meta[name='description']")?.content || "",
      canonical: doc.querySelector("link[rel='canonical']")?.href || "",
      robots: doc.querySelector("meta[name='robots']")?.content || "",
      author: doc.querySelector("meta[name='author']")?.content || "",
      ogImage: doc.querySelector("meta[property='og:image']")?.content || "",
      twitterImage: doc.querySelector("meta[name='twitter:image']")?.content || "",
      h1: [...doc.querySelectorAll("h1")].map(h => h.innerText),
      h2: [...doc.querySelectorAll("h2")].map(h => h.innerText),
      h3: [...doc.querySelectorAll("h3")].map(h => h.innerText),
      bold: [...doc.querySelectorAll("b,strong")].map(b => b.innerText),
      images: {
        total: doc.querySelectorAll("img").length,
        withAlt: [...doc.querySelectorAll("img")].filter(i => i.alt).length
      },
      links: {
        total: doc.querySelectorAll("a").length,
        internal: [...doc.querySelectorAll("a")].filter(a => a.href.includes(location.hostname)).length,
        external: [...doc.querySelectorAll("a")].filter(a => !a.href.includes(location.hostname)).length
      },
      wordCount: doc.body.innerText.split(/\s+/).filter(w => w).length
    };

    const seoScore = calculateSeoScore(parsed);
    const circleRadius = 50;
    const circumference = 2 * Math.PI * circleRadius;
    const offset = circumference - (seoScore / 100) * circumference;

    document.getElementById("results").innerHTML = `
      <section class="bg-white p-6 shadow rounded-lg">
        <h2 class="text-xl font-bold mb-4">⭐ SEO Score</h2>
        <svg class="w-32 h-32 transform -rotate-90 mx-auto mb-4">
          <circle cx="64" cy="64" r="${circleRadius}" stroke="#e5e7eb" stroke-width="10" fill="none"/>
          <circle cx="64" cy="64" r="${circleRadius}" stroke="${seoScore>=80?'#16a34a':seoScore>=50?'#facc15':'#dc2626'}"
            stroke-width="10" fill="none" stroke-dasharray="${circumference}"
            stroke-dashoffset="${offset}" stroke-linecap="round"/>
        </svg>
        <p class="text-center text-lg font-bold">${seoScore} / 100</p>
      </section>

      <section class="bg-white p-6 shadow rounded-lg">
        <h2 class="text-xl font-bold mb-4">🔎 Struktur-Analyse</h2>
        <ul class="list-disc pl-6 space-y-1">
          <li>${checkCount("H1", parsed.h1.length,1,1)}</li>
          <li>${checkCount("H2", parsed.h2.length,2,null)}</li>
          <li>${checkCount("H3", parsed.h3.length,1,null)}</li>
          <li>${checkCount("Fette Wörter", parsed.bold.length,3,15)}</li>
          <li>Bilder: ${parsed.images.withAlt}/${parsed.images.total} mit ALT</li>
          <li>Wörter im Text: ${parsed.wordCount}</li>
        </ul>
      </section>

      <section class="bg-white p-6 shadow rounded-lg">
        <h2 class="text-xl font-bold mb-4">📑 Meta-Daten</h2>
        <p><b>Title:</b> ${parsed.title} (${checkLength(parsed.title,10,60)})</p>
        <p><b>Description:</b> ${parsed.description} (${checkLength(parsed.description,50,160)})</p>
        <p><b>Canonical:</b> ${parsed.canonical||"❌ fehlt"}</p>
        <p><b>Robots:</b> ${parsed.robots||"❌ fehlt"}</p>
        <p><b>Author:</b> ${parsed.author||"❌ fehlt"}</p>
        <p><b>OG Image:</b> ${parsed.ogImage||"❌ fehlt"}</p>
        <p><b>Twitter Image:</b> ${parsed.twitterImage||"❌ fehlt"}</p>
      </section>

      <section class="bg-white p-6 shadow rounded-lg">
        <h2 class="text-xl font-bold mb-4">🔗 Links</h2>
        <p>Insgesamt: ${parsed.links.total}</p>
        <p>Intern: ${parsed.links.internal}</p>
        <p>Extern: ${parsed.links.external}</p>
      </section>
    `;

    setTimeout(()=>overlay.classList.add("hidden"),500);
  } catch (err) {
    document.getElementById("results").innerHTML = `<p class="text-red-600">❌ Fehler: ${err.message}</p>`;
    overlay.classList.add("hidden");
  } finally {
    clearInterval(progressInterval);
    btn.disabled = false;
    btnText.textContent = "🚀 Prüfen";
  }
});
</script>
</body>
</html>
